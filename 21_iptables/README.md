# Домашнее задание cценарии iptables

Цель: Написать сценарии iptables.

Нужно сделать:

- реализовать knocking port;
- centralRouter может попасть на ssh inetrRouter через knock скрипт;
- добавить inetRouter2, который маршрутизируется (host-only тип сети для виртуалки) с хоста или форвардится порт через локалхост;
- запустить nginx на centralServer;
- пробросить 80й порт на inetRouter2 8080;
- дефолт в инет оставить через inetRouter.

## Создание тестовой среды

Для базы для создания тестовой среды возьмем `Vagrantfile` из задания networks и немного его видоизменим. Добавим `inetrouter2` и создадим подсеть для его соединения с `centralRouter`. Также для ускорения создания удалим неиспользуемые в этом задании виртуальные машины. 

Запустим создание виртуальных машин.

```bash
vagrant up
```

## Настройка и проверка окружения

После успешного завершения запустим плейбук `setup.yaml` для установки необходимых пакетов настройки сетевой инфораструктуры.

```bash
ansible-playbook setup.yaml
```

Если с первого запуска на `centrtalServer` не будет интеренета и плейбук выпадет в ошибку, требуется повторно его запустить. Возможно это связано с задержкой уствновки соединения между вм после назначения маршрутов.

После успешной настройки с помощью плейбука `setup.yaml` можно зайти на хост `inetServer2` и проверить доступность nginx на `centralServer` с помощью комманды:

```bash
curl 192.168.0.2
```

Для настройки `port knocking` на `inetServer2` требуется запустить плейбук `knockd.yaml`

```bash
ansible-playbook knockd.yaml
```

После успешного выполнения можно проверить работу сервиса с помощью утилиты `knock` c `centralServer`.

Функциональность каждого плейбука детально описана в комментариях по тексту.