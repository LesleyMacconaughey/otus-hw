---
##### Настройка VLAN 1 на хостах testClient1 и testServer1
- name: set up vlan1
  # Настройка будет производиться на хостах testClient1 и testServer1
  hosts: testClient1,testServer1
  # Настройка производится от root-пользователя
  become: true
  tasks:
  # Добавление темплейта в файл /etc/sysconfig/network-scripts/ifcfg-vlan1
  - name: Set up vlan1
    ansible.builtin.template:
      src: ifcfg-vlan1.j2
      dest: /etc/sysconfig/network-scripts/ifcfg-vlan1
      owner: root
      group: root
      mode: "0644"

  # Перезапуск службы NetworkManager
  - name: Restart network for vlan1
    ansible.builtin.service:
      name: NetworkManager
      state: restarted

##### Настройка VLAN 2 на хостах testClient2 и testServer2:
- name: Set up vlan2
  hosts: testClient2,testServer2
  become: true
  tasks:
  - name: Set up vlan2
    ansible.builtin.template:
      src: 50-cloud-init.yaml.j2
      dest: /etc/netplan/50-cloud-init.yaml
      owner: root
      group: root
      mode: "0644"

  - name: Apply set up vlan2
    ansible.builtin.shell: netplan apply
    become: true

##### Настройка LACP между хостами inetRouter и centralRouter

- name: Set up bond0
  hosts: inetRouter,centralRouter
  become: true
  tasks:
  - name: Set up ifcfg-bond0
    ansible.builtin.template:
      src: ifcfg-bond0.j2
      dest: /etc/sysconfig/network-scripts/ifcfg-bond0
      owner: root
      group: root
      mode: "0644"

  - name: Set up eth1,eth2
    ansible.builtin.copy:
      src: "{{ item }}"
      dest: /etc/sysconfig/network-scripts/
      owner: root
      group: root
      mode: "0644"
    with_items:
      - templates/ifcfg-eth1
      - templates/ifcfg-eth2
# Перезагрузка хостов
  - name: Restart hosts for bond0
    ansible.builtin.reboot:
      reboot_timeout: 3600
